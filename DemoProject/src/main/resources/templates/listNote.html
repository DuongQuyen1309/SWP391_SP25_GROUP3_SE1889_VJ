<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Rice Sales Management</title>
    <link rel="stylesheet" href="/css/base.css">
    <style>
        .pagination {
            text-align: center;
            margin-top: 20px;
        }

        .pagination a {
            display: inline-block;
            padding: 8px 16px;
            margin: 4px;
            text-decoration: none;
            background-color: #2c3e50;
            color: white;
            border-radius: 5px;
        }

        .pagination a:hover {
            background-color: #1a252f;
        }

        .pagination span {
            font-size: 18px;
            margin: 0 10px;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .add-note-button {
            background-color: #d35400;
            color: white;
            font-size: 16px;
            font-weight: bold;
            text-decoration: none;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            padding: 10px 20px;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
        }

        .add-note-button:hover {
            background-color: #e67e22;
            transform: scale(1.05);
        }

        .thumbnail {
            width: 100px;
            height: auto;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .thumbnail:hover {
            transform: scale(1.1);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            padding-top: 50px;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
        }

        .modal-content {
            margin: auto;
            display: block;
            max-width: 90%;
            max-height: 80vh;
        }

        .close {
            position: absolute;
            top: 20px;
            right: 35px;
            color: white;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
        }

        .thumbnail {
            width: 80px;
            height: auto;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .thumbnail:hover {
            transform: scale(1.1);
        }

        .customer-info-card {
            background-color: #f7f9fb;
            border: 1px solid #dcdfe3;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            display: grid;
            /*grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));*/
            grid-template-columns:      6%       /* Id */
                                        18%      /* Name */
                                        18%      /* Date of Birth */
                                        20%      /* Address */
                                        18%      /* Phone */
                                        18%;     /* MoneyState */

            gap: 10px 20px;
            font-size: 16px;
            line-height: 1.6;
        }
        .customer-info-card div {
            color: #2c3e50;
        }
        .customer-info-card strong {
            color: #34495e;
        }
        .label {
            font-weight: bold;
            color: #34495e;
            margin-right: 4px;
        }

    </style>
    <script src="/js/home.js"></script>
    <script>
        function confirmUpdate(event, form) {
            event.preventDefault(); // NgƒÉn form submit ngay l·∫≠p t·ª©c
            if (confirm("Are you sure to update customer?")) {
                form.submit(); // N·∫øu ng∆∞·ªùi d√πng x√°c nh·∫≠n, ti·∫øp t·ª•c submit form
            }
        }
    </script>
    <script>
        function callPage() {
            let customerId = "[[${customer.id}]]"; // Gi·ªØ nguy√™n ID kh√°ch h√†ng khi l·ªçc
            window.location.href = '/note/createNote/' + customerId ;
        }
        function showCreatedSuccess() {
            alert("You are successfully created!");
        }
    </script>
    <script type="text/javascript" th:inline="javascript">
        function showMessage(messageType, message) {
            if (message && messageType) {
                alert(message);
                // ƒêi·ªÅu h∆∞·ªõng v·ªÅ trang listCustomer sau 3 gi√¢y
                var customerId = /*[[${customer.id}]]*/ '0';
                setTimeout(function () {
                    window.location.href = "/note/listNote/" + customerId;
                });
                // Hi·ªÉn th·ªã th√¥ng b√°o b·∫±ng alert
            }
        }
    </script>
    <script>
        function filterNotes() {
            let params = new URLSearchParams();
            document.querySelectorAll('.filter-input').forEach(input => {
                if (input.value.trim() !== '') { // Ch·ªâ th√™m tham s·ªë n·∫øu c√≥ gi√° tr·ªã
                    params.append(input.name, input.value);
                }
            });

            let customerId = "[[${customer.id}]]"; // Gi·ªØ nguy√™n ID kh√°ch h√†ng khi l·ªçc
            window.location.href = '/note/listNote/' + customerId + '?' + params.toString();
        }
        document.addEventListener("DOMContentLoaded", function() {
            let params = new URLSearchParams(window.location.search);
            document.querySelectorAll('.filter-input').forEach(input => {
                if (params.has(input.name)) {
                    let value = params.get(input.name);
                    if (input.type === "date") {
                        input.value = value.substring(0, 10); // ƒê·ªãnh d·∫°ng YYYY-MM-DD
                    } else {
                        input.value = value;
                    }
                }
            });
        });

    </script>
</head>
<body>

<!-- Header -->
<div class="header">
    <button class="menu-btn" onclick="toggleSidebar()">‚ò∞</button>
    <h2><a href="/home">RSMS</a></h2>
    <div class="user-info">
        <img src="/images/account.jpg" alt="User Avatar" class="user-avatar"/>
        <div class="dropdown">
            <span th:text="${account.displayName}" class="user-name" onclick="toggleDropdown()"> ‚ñº</span>
            <div id="dropdown-menu" class="dropdown-content">
                <a href="/user/userprofile">üë§ View Profile</a>
                <a href="/#" id="logout">üö™ Logout</a>
            </div>
        </div>
    </div>
</div>

<!-- Sidebar -->
<div class="sidebar" id="sidebar">

    <h2>Feature</h2>
    <a href="/user/userprofile" >Profile</a>
    <a href="/account/listStaff" th:style="${#lists.contains(listHiddenPage, 'listStaff')} ? 'display: none;' : ''">Staff Account Management</a>


    <a href="/product/listProduct" >Rice Management</a>

    <a href="/customer/listCustomer" >Customer Management</a>

    <a href="/warehouse/listWarehouseZone" >WarehouseZone Management</a>


    <a href="/listInvoice" >Invoice Management</a>

</div>


<!-- Content -->
<div class="content" id="content">

    <!-- Modal Form -->
<!--    <button class="add-customer" onclick="callPage()">Create New Note</button>-->


    <div id="messageBox">
        <script type="text/javascript">
            // G·ªçi h√†m showMessage v·ªõi messageType v√† message t·ª´ flash attributes
            /* Thymeleaf s·∫Ω thay th·∫ø c√°c gi√° tr·ªã n√†y */
            let messageType = '[[${messageType}]]';
            let message = '[[${message}]]';

            if (message && message.trim() !== '') {
                showMessage(messageType, message);
            }
        </script>
    </div>

    <h2>Information about Customer</h2>
    <div class="customer-info-card">
        <div><span class="label">Id:</span> <span th:text="${customer.id}"></span></div>
        <div><span class="label">Name:</span> <span th:text="${customer.name}"></span></div>
        <div><span class="label">Date of Birth:</span><span th:text="${customer.dob}"></span></div>
        <div><span class="label">Address:</span><span th:text="${customer.address}"></span></div>
        <div><span class="label">Phone:</span>
            <span th:text="${customer.phone != null and #strings.equals(role, 'OWNER')}
            ? ${customer.phone}
            : ${'x'.repeat(customer.phone.length() - 3) + customer.phone.substring(customer.phone.length() - 3)}">
        </span>
        </div>
        <div><span class="label">MoneyState:</span><span th:text="${customer.moneyState}"></span></div>
    </div>

    <div class="header-container">
        <h2 >Information about Notes</h2>
        <div>
            <a th:href="@{/note/createNote/{id}(id=${customer.id})}" class="add-note-button">Create New Note</a>
            <a th:href="@{/customer/listCustomer}" class="add-note-button">Back</a>
        </div>
    </div>

    <div th:if="${errorMessage}" style="color: red; font-weight: bold;">
        <p th:text="${errorMessage}"></p>
    </div>
    <table class="styled-table">
        <thead>
        <tr>
            <td>Id</td>
            <td>Kind of Note</td>
            <td>Created Date</td>
            <td>Note</td>
            <td>Money</td>
            <td>Created By</td>
            <td>Image</td>
        </tr>
        <tr>
            <td class="twin-field" style="width: 5%;">
                <div style="display: flex; gap: 3%; width: 100%;">
                    <input type="text" class="filter-input" name="idFrom"
                           onchange="filterNotes()"
                           style="width: 48%;"/>
                    <input type="text" class="filter-input" name="idTo"
                           onchange="filterNotes()"
                           style="width: 48%;"/>
                </div>
            </td>
            <td >
                <select class="filter-input" name="kindOfNote" onchange="filterNotes()" style="width: 50%;">
                    <option value="">--------All--------</option>
                    <option value="customerOwe">Customer owes money</option>
                    <option value="customerPay">Customer pays money</option>
                    <option value="storeOwe">Store owes money</option>
                    <option value="storePay">Store pays money</option>
                </select>
            </td>
            <td class="twin-field" style="width: 5%;">
                <div style="display: flex; gap: 3%; width: 100%;">
                    <input type="datetime-local" class="filter-input" name="createdDateFrom"
                           onchange="filterNotes()"
                           style="width: 30%;"/>
                    <input type="datetime-local" class="filter-input" name="createdDateTo"
                           onchange="filterNotes()"
                           style="width: 30%;"/>
                </div>
            </td>
            <td style="width: 20%;">
                <input type="text" class="filter-input" name="noteSearch" onchange="filterNotes()" style="width: 40%;">
            </td>
            <td class="twin-field" style="width: 15%;">
                <div style="display: flex; gap: 10%; width: 100%;">
                    <input type="text" class="filter-input" name="moneyFrom"
                           onchange="filterNotes()"
                           style="width: 48%;"/>
                    <input type="text" class="filter-input" name="moneyTo"
                           onchange="filterNotes()"
                           style="width: 48%;"/>
                </div>
            </td>
            <td>
                <select class="filter-input" name="createBy" onchange="filterNotes()" style="width: 70%;">
                    <option value="">All</option>
                    <option th:each="user : ${usersList}" th:value="${user.id}" th:text="${user.name}"></option>
                </select>
            </td>
            <td></td>
        </tr>
        </thead>
        <tbody>
        <tr th:each="note : ${notes}">
            <td th:if="${note != null}" th:text="${note.id}"></td>
            <td th:if="${note != null}" th:text="${note.debt}"></td>
            <td th:if="${note != null}" th:text="${#temporals.format(note.createdAt, 'yyyy-MM-dd HH:mm:ss')}"></td>
            <td th:if="${note != null}" th:text="${note.note}"></td>
            <td th:if="${note != null}" th:text="${note.money}"></td>
            <td th:if="${note != null}">
                <span th:each="user : ${usersList}"
                th:text="${user.id == note.createdBy ? user.name : ''}"></span>
            </td>
            <td>
                <img th:if="${note.imagePath != null}"
                     th:src="@{/note/image/{filename}(filename=${note.imagePath})}"
                     alt="Note Image" class="thumbnail" onclick="openImageModal(this.src)">
            </td>
        </tr>

        <div id="imageModal" class="modal">
            <span class="close" onclick="closeImageModal()">&times;</span>
            <img class="modal-content" id="modalImg">
        </div>

        <script>
            function openImageModal(src) {
                let modal = document.getElementById("imageModal");
                let modalImg = document.getElementById("modalImg");

                modal.style.display = "flex"; // Hi·ªÉn th·ªã modal
                modalImg.src = src;
                modalImg.style.transform = "scale(3)";
            }

            function closeImageModal() {
                document.getElementById("imageModal").style.display = "none";
            }
        </script>
        </tbody>
    </table>
    <!-- Ph√¢n trang -->
    <div class="pagination">
            <a th:if="${currentPage > 0}"
               th:href="@{/note/listNote/{id}(id=${customer.id}, page=${currentPage - 1}, size=${size},
       idFrom=${idFrom}, idTo=${idTo},
       kindOfNote=${kindOfNote},
       createdDateFrom=${createdDateFrom},
       createdDateTo=${createdDateTo},
       noteSearch=${noteSearch},
       moneyFrom=${moneyFrom},
       moneyTo=${moneyTo}, createBy=${createBy})}">
                Previous
            </a>

            <span>Page <span th:text="${currentPage + 1}"></span> of <span th:inline="text">[[${totalPages == 0 ? 1 : totalPages}]]</span></span>

            <a th:if="${currentPage + 1 < totalPages}"
               th:href="@{/note/listNote/{id}(id=${customer.id}, page=${currentPage + 1}, size=${size},
       idFrom=${idFrom}, idTo=${idTo},
       kindOfNote=${kindOfNote},
       createdDateFrom=${createdDateFrom},
       createdDateTo=${createdDateTo},
       noteSearch=${noteSearch},
       moneyFrom=${moneyFrom},
       moneyTo=${moneyTo},createBy=${createBy})}">
            Next
        </a>
    </div>
</div>
<footer>
    &copy; 2025 Rice Sales Management. All Rights Reserved.
</footer>

</body>
</html>

