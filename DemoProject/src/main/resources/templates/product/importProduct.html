<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω b√°n h√†ng</title>
    <link rel="stylesheet" href="/css/base.css">
    <link rel="stylesheet" href="/css/bill.css">
    <link rel="icon" type="image/x-icon" th:href="@{/images/account.jpg}">
    <script src="/js/home.js"></script>
</head>
<body>
<!-- Header -->
<div class="header">
    <button class="menu-btn" onclick="toggleSidebar()">‚ò∞</button>
    <h2><a href="/home">RSMS</a></h2>
    <div class="user-info">
        <img th:src="${user.avatar}" alt="User Avatar" class="user-avatar"/>
        <div class="dropdown">
            <span th:text="${account.displayName}" class="user-name" onclick="toggleDropdown()"> ‚ñº</span>
            <div id="dropdown-menu" class="dropdown-content">
                <a href="/user/userprofile">üë§ View Profile</a>
                <a href="/user/changepw" id="changepw">üîë Change password</a>
                <a href="/static#" id="logout">üö™ Logout</a>
            </div>
        </div>
    </div>
</div>

<!-- Sidebar -->
<div class="sidebar" id="sidebar" style="height: 100%;">
    <h2>Feature</h2>
    <a href="/user/userprofile">Profile</a>
    <a href="/account/listStaff" th:style="${#lists.contains(listHiddenPage, 'listStaff')} ? 'display: none;' : ''">Staff Account Management</a>
    <a href="/product/listProduct">Rice Management</a>
    <a href="/customer/listCustomer">Customer Management</a>
    <a href="/warehouse/listWarehouseZone">Warehouse Management</a>
    <a href="/bill/listBill">Invoice Management</a>
</div>


<!-- Content -->
<div class="content">
    <div>
        <span style="margin-left: 250px; padding-left: 50px" class="tab active">Phi·∫øu nh·∫≠p g·∫°o</span>

    </div>

    <div class="main-container">
        <div class="left-panel">
            <!-- N√∫t th√™m s·∫£n ph·∫©m -->
            <div class="add-product" id="add-product" >
                <span onclick="showProductModal()">+ T√™n s·∫£n ph·∫©m</span>
                <label style="margin-left: 300px">Ng√†y nh·∫≠p:
                    <input type="date" name="importDate" id="importDate" />
                </label>
            </div>

            <!-- Modal ch·ª©a danh s√°ch s·∫£n ph·∫©m -->
            <div id="product-modal" class="modal">
                <div class="modal-content">
                    <span class="close" onclick="closeProductModal()">√ó</span>
                    <h2>Ch·ªçn s·∫£n ph·∫©m</h2>
                    <input type="text" id="search-product" class="styled-input" placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m..." onkeyup="searchProduct()">
                    <div id="product-list" class="product-list">
                        <p>Nh·∫≠p t√™n s·∫£n ph·∫©m ƒë·ªÉ t√¨m ki·∫øm...</p>
                    </div>
                </div>
            </div>

            <!-- Danh s√°ch s·∫£n ph·∫©m -->
            <div class="products-container">
                <table>
                    <thead>
                    <tr>
                        <th>#</th>
                        <th>S·∫£n ph·∫©m</th>
                        <th class="quantity-cell">SL</th>
                        <th style="width: 20px" class="price-cell">ƒê∆°n gi√°</th>
                        <th class="price-cell">Th√†nh ti·ªÅn</th>
                        <th>Zone</th>
                        <th>X√≥a</th>
                    </tr>
                    </thead>
                    <tbody id="selected-products"></tbody>
                </table>
            </div>
        </div>

        <div class="right-panel">
            <!-- Th√¥ng tin kh√°ch h√†ng -->
            <div class="section">
                <div class="section-header">Th√¥ng tin kh√°ch h√†ng</div>
                <div class="section-content">
                    <div class="form-group">
                        <div class="customer-buttons">
                            <button id="search-customer-btn">üîç T√¨m</button>
                            <button id="add-customer-btn">‚ûï Th√™m</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="customer-name">Kh√°ch h√†ng</label>
                        <input type="text" class="form-control" id="customer-name" style="width: 230px">
                    </div>
                    <div class="form-group">
                        <label for="customer-address">ƒê·ªãa ch·ªâ</label>
                        <input type="text" class="form-control" id="customer-address" style="width: 90%">
                    </div>
                    <div class="form-group">
                        <label for="customer-phone">S·ªë ƒëi·ªán tho·∫°i</label>
                        <input type="text" class="form-control" id="customer-phone" style="width: 90%">
                    </div>
                    <div class="form-group">
                        <label for="customer-gender">Gender</label>
                        <input type="text" class="form-control" id="customer-gender" style="width: 90%">
                    </div>
                    <div class="form-group">
                        <label for="customer-dob">Date Of Birth</label>
                        <input type="text" class="form-control" id="customer-dob" style="width: 90%">
                    </div>
                    <div class="form-group">
                        <label for="customer-moneystate">N·ª£ c≈©</label>
                        <input type="text" class="form-control" id="customer-moneystate" style="width: 90%">
                    </div>
                    <div class="form-group">
                        <label for="customer-totaldebt">T·ªïng c√¥ng n·ª£</label>
                        <input type="text" class="form-control" id="customer-totaldebt" readonly style="width: 90%">
                    </div>
                </div>
            </div>

            <!-- Popup t√¨m ki·∫øm kh√°ch h√†ng -->
            <div id="customer-search-modal" class="modal">
                <div class="modal-content">
                    <span class="close" onclick="closeCustomerSearchModal()">√ó</span>
                    <h2>T√¨m ki·∫øm kh√°ch h√†ng</h2>
                    <input type="text" id="search-customer-input" class="styled-input" placeholder="Nh·∫≠p t√™n kh√°ch h√†ng..." onkeyup="searchCustomer()">
                    <div id="customer-list" class="customer-list"></div>
                </div>
            </div>

            <!-- Popup th√™m kh√°ch h√†ng -->
            <div id="add-customer-modal" class="modal">
                <div class="modal-content">
                    <span class="close" onclick="closeAddCustomerModal()">√ó</span>
                    <h2>Th√™m kh√°ch h√†ng m·ªõi</h2>
                    <div class="form-group">
                        <label for="new-customer-name">T√™n kh√°ch h√†ng</label>
                        <input type="text" class="form-control" id="new-customer-name">
                    </div>
                    <div class="form-group">
                        <label for="new-customer-gender">Gender:</label>
                        <select id="new-customer-gender">
                            <option value="true">Male</option>
                            <option value="false">Female</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="new-customer-address">ƒê·ªãa ch·ªâ</label>
                        <input type="text" class="form-control" id="new-customer-address">
                    </div>
                    <div class="form-group">
                        <label for="new-customer-phone">S·ªë ƒëi·ªán tho·∫°i</label>
                        <input type="text" class="form-control" id="new-customer-phone">
                    </div>
                    <div class="form-group">
                        <label for="new-customer-dob">Date of birth</label>
                        <input type="date" class="form-control" id="new-customer-dob">
                    </div>
                    <button id="save-customer-btn">L∆∞u kh√°ch h√†ng</button>
                </div>
            </div>

            <!-- T·ªïng c·ªông -->
            <div class="section">
                <div class="section-header">T·ªïng c·ªông</div>
                <div class="section-content">
                    <div class="total-row">
                        <span class="total-label">T·ªïng ti·ªÅn h√†ng:</span>
                        <span class="total-value" id="total-amount">0</span>
                    </div>
                    <div class="total-row">
                        <span class="total-label">C·∫ßn ph·∫£i tr·∫£:</span>
                        <span class="total-value highlight" id="customer-pay">0</span>
                    </div>
                </div>
            </div>

            <!-- Thanh to√°n -->
            <div class="section">
                <div class="section-header">Thanh to√°n</div>
                <div class="section-content">
                    <div class="total-row">
                        <span class="total-label">ƒê√£ tr·∫£ cho kh√°ch:</span>
                    </div>
                    <div class="total-row" style="display:block">
                        <input type="text" style="width: 90%" class="form-control" id="customer-payment" placeholder="Nh·∫≠p s·ªë ti·ªÅn ƒë√£ thanh to√°n">
                        <span id="customer-payment-error" class="error-message"></span>
                    </div>
                    <div class="payment-method" style="margin-top: 10px">
                        <input type="checkbox" name="payment" id="loading">
                        <label for="loading" class="total-label">B·ªëc h√†ng</label>
                    </div>
                    <div class="total-row" style="display: block">
                        <span class="total-label">Ti·ªÅn b·ªëc h√†ng:</span>
                        <input type="text" class="form-control" id="loading-amount" value="0" readonly style="width: 90%; margin-top: 5px">
                        <span id="loading-amount-error" class="error-message"></span>
                    </div>
                </div>
                <button class="checkout-button">THANH TO√ÅN</button>
            </div>
        </div>
    </div>
</div>

<footer>
    ¬© 2025 Rice Sales Management. All Rights Reserved.
</footer>

<script src="/js/bill.js"></script>

<script>
    // Khai b√°o c√°c bi·∫øn to√†n c·ª•c
    let zones = [];
    let customer = {};
    let products = [];
    let payment = { totalDebt: 0, customerPayment: 0, loading: false, loadingAmount: 0 };

    // L·∫•y danh s√°ch zone t·ª´ server
    fetch('/warehouse/getZones')
        .then(response => response.json())
        .then(data => {
            zones = data; // L∆∞u danh s√°ch zone v·ªõi id v√† name
            renderProducts(); // Render l·∫°i n·∫øu c·∫ßn
        })
        .catch(error => console.error("L·ªói l·∫•y danh s√°ch zone:", error));

    // H√†m ƒë·ªãnh d·∫°ng gi√°
    function formatPrice(price) {
        return new Intl.NumberFormat('vi-VN').format(price);
    }

    // H√†m ph√¢n t√≠ch gi√° t·ª´ chu·ªói
    function parsePrice(priceStr) {
        if (!priceStr) return 0;
        if (priceStr === "0") return 0;
        return parseInt(priceStr.replace(/,/g, '').replace(/[^\d-]/g, '')) || 0;
    }

    // Hi·ªÉn th·ªã v√† ƒë√≥ng modal s·∫£n ph·∫©m
    function showProductModal() {
        document.getElementById("product-modal").style.display = "flex";
    }

    function closeProductModal() {
        document.getElementById("product-modal").style.display = "none";
    }

    // NgƒÉn ch·ªânh s·ª≠a c√°c tr∆∞·ªùng kh√°ch h√†ng
    document.getElementById("customer-name").readOnly = true;
    document.getElementById("customer-address").readOnly = true;
    document.getElementById("customer-phone").readOnly = true;
    document.getElementById("customer-gender").readOnly = true;
    document.getElementById("customer-dob").readOnly = true;
    document.getElementById("customer-moneystate").readOnly = true;
    document.getElementById("customer-totaldebt").readOnly = true;

    ['customer-name', 'customer-address', 'customer-phone', 'customer-gender', 'customer-dob', 'customer-moneystate', 'customer-totaldebt'].forEach(id => {
        document.getElementById(id).addEventListener("keydown", function(event) {
            event.preventDefault();
        });
        document.getElementById(id).addEventListener("contextmenu", function(event) {
            event.preventDefault();
        });
    });

    // Ch·ªçn s·∫£n ph·∫©m
    function selectProduct(id, name, price) {
        let existingProduct = products.find(p => p.id === id);
        if (existingProduct) {
            alert("S·∫£n ph·∫©m n√†y ƒë√£ ƒë∆∞·ª£c th√™m!");
            return;
        }
        products.push({ id, name, price, quantity: 1, zoneId: null });
        document.getElementById("search-product").value = "";
        document.getElementById("product-list").innerHTML = "<p>Nh·∫≠p t√™n s·∫£n ph·∫©m ƒë·ªÉ t√¨m ki·∫øm...</p>";
        renderProducts();
        updateOrderTotal();
        updateTotalDebt();
        closeProductModal();
    }

    // S·ª± ki·ªán n√∫t t√¨m ki·∫øm v√† th√™m kh√°ch h√†ng
    document.getElementById("search-customer-btn").addEventListener("click", function () {
        document.getElementById("customer-search-modal").style.display = "flex";
    });

    function closeCustomerSearchModal() {
        document.getElementById("customer-search-modal").style.display = "none";
    }

    document.getElementById("add-customer-btn").addEventListener("click", function () {
        document.getElementById("add-customer-modal").style.display = "flex";
    });

    function closeAddCustomerModal() {
        document.getElementById("add-customer-modal").style.display = "none";
    }

    // T√¨m ki·∫øm kh√°ch h√†ng
    function searchCustomer() {
        let keyword = document.getElementById("search-customer-input").value.trim();
        let customerList = document.getElementById("customer-list");
        if (keyword.length >= 1) {
            customerList.style.display = "block";
            customerList.innerHTML = "<p>ƒêang t√¨m ki·∫øm...</p>";
            fetch(`/bill/searchCustomers?keyword=${keyword}`)
                .then(response => response.json())
                .then(data => {
                    if (data.length === 0) {
                        customerList.innerHTML = `<p>Kh√¥ng t√¨m th·∫•y kh√°ch h√†ng.</p>`;
                    } else {
                        customerList.innerHTML = data.map(customer => `
                        <div class="customer-item" onclick="selectCustomer(
                            '${customer.name}',
                            '${customer.phone}',
                            '${customer.address}',
                            '${customer.dob}',
                            '${customer.gender}',
                            '${customer.moneyState}'
                        )">
                            ${customer.name} - ${customer.phone}
                        </div>
                    `).join("");
                    }
                })
                .catch(error => {
                    console.error("L·ªói t√¨m ki·∫øm:", error);
                    customerList.innerHTML = "<p>L·ªói khi t√¨m ki·∫øm</p>";
                });
        } else {
            customerList.innerHTML = "";
            customerList.style.display = "none";
        }
    }

    // Ch·ªçn kh√°ch h√†ng
    function selectCustomer(name, phone, address, dob, gender, moneystate) {
        customer = { name, phone, address, dob, gender, moneystate };
        document.getElementById("customer-name").value = name;
        document.getElementById("customer-phone").value = phone;
        document.getElementById("customer-address").value = address;
        document.getElementById("customer-dob").value = dob;
        document.getElementById("customer-gender").value = gender;
        document.getElementById("customer-moneystate").value = moneystate;
        document.getElementById("customer-totaldebt").value = moneystate;
        closeCustomerSearchModal();
        updateTotalDebt();
    }

    // L∆∞u kh√°ch h√†ng m·ªõi
    document.getElementById("save-customer-btn").addEventListener("click", function () {
        let name = document.getElementById("new-customer-name").value.trim();
        let phone = document.getElementById("new-customer-phone").value.trim();
        let address = document.getElementById("new-customer-address").value.trim();
        let dob = document.getElementById("new-customer-dob").value.trim();
        let gender = document.getElementById("new-customer-gender").value.trim();
        if (!name || !phone || !address) {
            alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin kh√°ch h√†ng!");
            return;
        }
        let requestData = { name, phone, address, dob, gender };
        fetch("/bill/addCustomer", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(requestData)
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("Th√™m kh√°ch h√†ng th√†nh c√¥ng!");
                    closeAddCustomerModal();
                } else {
                    alert("L·ªói khi th√™m kh√°ch h√†ng: " + data.message);
                }
            })
            .catch(error => {
                console.error("L·ªói g·ª≠i d·ªØ li·ªáu:", error);
                alert("C√≥ l·ªói x·∫£y ra khi g·ª≠i d·ªØ li·ªáu.");
            });
    });

    // Render danh s√°ch s·∫£n ph·∫©m
    function renderProducts() {
        let productTable = document.getElementById("selected-products");
        productTable.innerHTML = "";
        products.forEach((product, index) => {
            let row = `
            <tr id="product-${product.id}">
                <td>${index + 1}</td>
                <td>${product.name}</td>
                <td class="quantity-cell">
                    <span class="quantity-value">${product.quantity}</span>
                    <div class="quantity-controls">
                        <div class="quantity-btn minus" onclick="changeQuantity(${product.id}, -1)">-</div>
                        <div class="quantity-btn plus" onclick="changeQuantity(${product.id}, 1)">+</div>
                    </div>
                </td>
                <td class="price-cell">
                    <input style="width: 60px" type="text" class="unit-price-input" value="${formatPrice(product.price)}"
                    onchange="updateUnitPrice(${product.id}, this.value)"
                    oninput="validateNumber(this)"
                    >
                </td>
                <td style="text-align: center" class="price-cell total-price">${formatPrice(product.price * product.quantity)}</td>
                <td>
                    <select class="zone-select" onchange="updateProductZone(${product.id}, this.value)">
                        <option value="">Ch·ªçn zone</option>
                        ${zones.map(zone => `<option value="${zone.id}" ${product.zoneId === zone.id ? 'selected' : ''}>${zone.name}</option>`).join('')}
                    </select>
                </td>
                <td><button onclick="removeProduct(${product.id})">‚úñ</button></td>
            </tr>
        `;
            productTable.insertAdjacentHTML("beforeend", row);
        });
    }

    // C·∫≠p nh·∫≠t ƒë∆°n gi√°
    function updateUnitPrice(productId, newPriceStr) {
        let product = products.find(p => p.id === productId);
        if (product) {
            let newPrice = parsePrice(newPriceStr);
            if (isNaN(newPrice) || newPrice < 0) {
                alert("Gi√° kh√¥ng h·ª£p l·ªá!");
                return;
            }
            product.price = newPrice;
            renderProducts();
            updateOrderTotal();
            updateTotalDebt();
        }
    }

    function validateNumber(input) {
        let value = input.value;

        let quantity = parseInt(value, 10);

        if (isNaN(quantity) || quantity < 1) {
            alert("ƒê∆°n gi√° kh√¥ng h·ª£p l·ªá!!!")
        } else {
            return;
        }
    }

    // C·∫≠p nh·∫≠t zone cho s·∫£n ph·∫©m
    function updateProductZone(productId, zoneId) {
        let product = products.find(p => p.id === productId);
        if (product) {
            product.zoneId = zoneId ? parseInt(zoneId) : null;
        }
    }

    // Thay ƒë·ªïi s·ªë l∆∞·ª£ng s·∫£n ph·∫©m
    function changeQuantity(id, change) {
        let product = products.find(p => p.id === id);
        if (product) {
            product.quantity = Math.max(1, product.quantity + change);
            renderProducts();
            updateOrderTotal();
            updateTotalDebt();
        }
    }

    // X√≥a s·∫£n ph·∫©m
    function removeProduct(id) {
        products = products.filter(p => p.id !== id);
        renderProducts();
        updateOrderTotal();
        updateTotalDebt();
    }

    // S·ª± ki·ªán checkbox "B·ªëc h√†ng"
    document.getElementById("loading").addEventListener("change", function () {
        let loadingAmountInput = document.getElementById("loading-amount");
        if (this.checked) {
            loadingAmountInput.removeAttribute("readonly");
        } else {
            loadingAmountInput.setAttribute("readonly", true);
            loadingAmountInput.value = "0";
        }
        updateOrderTotal();
        updateTotalDebt();
    });

    // C·∫≠p nh·∫≠t t·ªïng c√¥ng n·ª£ khi nh·∫≠p s·ªë ti·ªÅn thanh to√°n
    document.getElementById("customer-payment").addEventListener("input", function (event) {
        let inputValue = event.target.value.trim();
        let errorSpan = document.getElementById("customer-payment-error");
        let oldDebt = parsePrice(customer.moneystate || "0");
        if (inputValue === "") {
            errorSpan.textContent = "";
            event.target.classList.remove("input-error");
            document.getElementById("customer-totaldebt").value = formatPrice(oldDebt);
            return;
        }
        if (!/^\d+$/.test(inputValue)) {
            errorSpan.textContent = "Vui l√≤ng nh·∫≠p s·ªë nguy√™n d∆∞∆°ng!";
            event.target.classList.add("input-error");
            return;
        } else {
            errorSpan.textContent = "";
            event.target.classList.remove("input-error");
        }
        updateTotalDebt();
    });

    // C·∫≠p nh·∫≠t t·ªïng c√¥ng n·ª£
    function updateTotalDebt() {
        let customerName = document.getElementById("customer-name").value.trim();
        let oldDebt = parsePrice(customer.moneystate || "0");
        let payment = parsePrice(document.getElementById("customer-payment").value);
        let totalAmount = parsePrice(document.getElementById("total-amount").textContent) || 0;

        if (customerName === "") {
            document.getElementById("customer-totaldebt").value = "";
            return;
        }

        if (payment >= 0) {
            let totalDebt = oldDebt + (payment - totalAmount);
            document.getElementById("customer-totaldebt").value = formatPrice(totalDebt);
        } else {
            document.getElementById("customer-totaldebt").value = formatPrice(oldDebt);
        }
    }

    // C·∫≠p nh·∫≠t t·ªïng ti·ªÅn
    function updateOrderTotal() {
        let productTotal = products.reduce((sum, product) => sum + product.price * product.quantity, 0);
        let loadingFee = document.getElementById("loading").checked ? parsePrice(document.getElementById("loading-amount").value) : 0;
        let finalTotal = productTotal + loadingFee;
        document.getElementById("total-amount").textContent = formatPrice(finalTotal);
        document.getElementById("customer-pay").textContent = formatPrice(finalTotal);
    }

    // S·ª± ki·ªán nh·∫≠p ti·ªÅn b·ªëc h√†ng
    document.getElementById("loading-amount").addEventListener("input", function (event) {
        if (document.getElementById("loading").checked) {
            let inputValue = event.target.value;
            let errorSpan = document.getElementById("loading-amount-error");
            if (inputValue === "") {
                errorSpan.textContent = "";
                event.target.classList.remove("input-error");
                updateOrderTotal();
                updateTotalDebt();
                return;
            }
            if (!/^\d+$/.test(inputValue)) {
                errorSpan.textContent = "Vui l√≤ng nh·∫≠p s·ªë nguy√™n d∆∞∆°ng!";
                event.target.classList.add("input-error");
                return;
            } else {
                errorSpan.textContent = "";
                event.target.classList.remove("input-error");
            }
            updateOrderTotal();
            updateTotalDebt();
        }
    });

    // X·ª≠ l√Ω thanh to√°n
    document.querySelector(".checkout-button").addEventListener("click", function () {
        if (!customer.name || products.length === 0) {
            alert("Vui l√≤ng nh·∫≠p th√¥ng tin kh√°ch h√†ng v√† th√™m s·∫£n ph·∫©m!");
            return;
        }

        for (let product of products) {
            if (isNaN(product.price) || product.price <= 0) {
                alert("Gi√° s·∫£n ph·∫©m kh√¥ng h·ª£p l·ªá!");
                return;
            }
            if (!product.zoneId) {
                alert("Vui l√≤ng ch·ªçn zone cho t·∫•t c·∫£ s·∫£n ph·∫©m!");
                return;
            }
        }

        let productList = products.map(product => ({
            id: product.id,
            quantity: product.quantity,
            price: product.price,
            subtotal: product.price * product.quantity,
            zone: product.zoneId
        }));

        let requestData = {
            // customer: customer,
            importDate: document.getElementById("importDate").value,
            productData: productList
        };

        fetch("/product/import", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(requestData)
        })
            .then(response => {
                // Ki·ªÉm tra n·∫øu c√≥ chuy·ªÉn h∆∞·ªõng
                if (response.redirected) {
                    window.location.href = response.url; // Chuy·ªÉn h∆∞·ªõng th·ªß c√¥ng
                    return; // D·ª´ng x·ª≠ l√Ω ti·∫øp ƒë·ªÉ tr√°nh parse JSON
                }
                // N·∫øu kh√¥ng c√≥ chuy·ªÉn h∆∞·ªõng, parse JSON
                if (!response.ok) {
                    throw new Error(`L·ªói t·ª´ server: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                if (data && data.success) { // Ki·ªÉm tra data t·ªìn t·∫°i
                    alert("Thanh to√°n th√†nh c√¥ng!");
                    // Reset form
                    customer = {};
                    products = [];
                    document.getElementById("customer-name").value = "";
                    document.getElementById("customer-phone").value = "";
                    document.getElementById("customer-address").value = "";
                    document.getElementById("customer-dob").value = "";
                    document.getElementById("customer-gender").value = "";
                    document.getElementById("customer-moneystate").value = "";
                    document.getElementById("customer-totaldebt").value = "";
                    document.getElementById("customer-payment").value = "";
                    document.getElementById("loading").checked = false;
                    document.getElementById("loading-amount").value = "0";
                    document.getElementById("loading-amount").setAttribute("readonly", true);
                    renderProducts();
                    updateOrderTotal();
                } else if (data) {
                    alert("L·ªói khi x·ª≠ l√Ω thanh to√°n: " + (data.message || "Kh√¥ng c√≥ th√¥ng tin l·ªói"));
                }
            })
            .catch(error => {
                console.error("L·ªói chi ti·∫øt:", error);
                alert("C√≥ l·ªói x·∫£y ra khi g·ª≠i d·ªØ li·ªáu: " + error.message);
            });

    });
</script>
</body>
</html>